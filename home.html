<!DOCTYPE html>
<html lang="en">

<head>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <title>User Interface Mock-Up</title>

    <style>
        * {
            box-sizing: border-box;
        }

        p {
            font-size: 20px; 
            line-height: 0;
            text-align: center;
        }

        h1 {
            margin-bottom: 30px;
        }

        /* Satellite View */
        box { 
            float: left;
            width: 49%;
            height: 500px;
            border: solid 1px;
        }

        /* Street View */
        article1 {
            float: right;
            width: 49%;
            border: solid 1px;
            height: 295px;
        }

        /* Additional Information */
        article2 {
            float: left;
            margin-top: 10px;
            margin-left: 2%;
            width: 30%;
            border: solid 1px;
            height: 195px; 
        }

        /* Current Address and Buttons */
        article3 {
            float: right;
            margin-top: 10px;
            width: 18%;
            height: 295px; 
        }

        input.ChooseSubmit {
            font-size: 16px; 
            cursor: pointer;
        }

        div.buttonBlock {text-align: center;}

        div.buttonBlock button {
            padding: 10px 20px;
            text-align: center;
            font-size: 16px;
            cursor: pointer;
            vertical-align: middle;
            margin: 5px;
        }

        .myDiv {
            text-align: center;
            overflow-wrap: break-word;
            font-size: 20px;
        }

    </style>
</head>

<body>
    <h1 style="text-align: center;">User Interface Mock-Up</h1>
    <section>
        <box>
            <p><strong>Satellite View</strong></p>
            <iframe id="satellite" width="100%" height="92%" style="border:0" loading="lazy" allowfullscreen src="https://www.google.com/maps/embed/v1/place?q=place_id:ChIJq0KHTFYEzkwRvbPlVjh1VnI&key=AIzaSyCIF_zp9VV0GYMv-G83OVHa-NdVKsK5GJE&zoom=18&maptype=satellite"></iframe>
        </box>

        <article1>
            <p><strong>Street View</strong></p>
            <iframe id="street" width="100%" height="253px" style="border:0" loading="lazy" allowfullscreen src="https://www.google.com/maps/embed/v1/streetview?key=AIzaSyCIF_zp9VV0GYMv-G83OVHa-NdVKsK5GJE&location=45.4220%2C-75.7055&heading=170&pitch=16"></iframe>
        </article1>
    
        <article2>
            <p><strong>Additional Information</strong></p>
        </article2>

        <article3>
            <p><strong>Current Address:</strong></p>
            <div id="current" class="myDiv">
                301 Wellington St, Ottawa, ON K1A 0J1
            </div>
            <p id="position" style="line-height: 0.5;">1/1</p>

            <form id="myForm">
                <fieldset style="border: 0px; transform: translateX(8%);">
                    <input id="choose" type='file' id='csvFile' accept=".csv" class="ChooseSubmit">
                </fieldset>
            </form>

            <div class = "buttonBlock">
                <button id = "previous"; onclick="previous();">Previous</button>
                <button id = "next"; onclick="next();">Next</button>
            </div>
        </article3>
    </section>

    <script>
        var numAddresses = 1;
        var position = 1;
        var counter = 1;
        var data, currentAddress, lat, long, placeID;
        
        var csvFile = document.getElementsByTagName('input')[0];

        csvFile.onclick = function(){
            this.value = null;
        };
        
        csvFile.onchange = function(){
            loadFile();
        };

        function loadFile(){
            if (!csvFile.files[0]) {
                alert("Please select a file");
            }
            else if (csvFile.files[0].name.split(".").pop() !== "csv"){
                csvFile = null;
                alert("The file must be of type 'csv'");
            }  

            function csvToArray(allText) {
                var allTextLines = allText.split(/\r\n|\n/);
                var headers = allTextLines[0].split(',');
                var lines = [];
                for (var i=1; i<allTextLines.length; i++) {
                    var data = allTextLines[i].split(',');
                    if (data.length == headers.length) {
                        for (var j=0; j<headers.length; j++) {
                            lines.push(data[j]);
                        }
                    }
                }
                return lines.slice(0, -1);
            }
        
            var input = csvFile.files[0];
            var reader = new FileReader();
    
            reader.onload = function (e) {
                var text = e.target.result;
                data = csvToArray(text);
                numAddresses = data.length;
                document.getElementById("position").innerHTML = position + "/" + numAddresses;
                updateMap(returnAddress(position));
            };
            reader.readAsText(input);
        }

        function next(){
            if (!csvFile.files[0]) {
                alert("Please choose a file before clicking 'Next'");
            }
            if (position < numAddresses){
                position++;
                currentAddress = data[position-1];
            }
            document.getElementById("position").innerHTML = position + "/" + numAddresses;
            document.getElementById("current").innerHTML = JSON.stringify(data[position-1]).replace(/"/g,"");
            updateMap(returnAddress(position));
        }

        function previous(){
            if (!csvFile.files[0]) {
                alert("Please choose a file before clicking 'Previous'");
            }
            if (position > 1){
                position--;
                currentAddress = data[position-1];
            }
            document.getElementById("position").innerHTML = position + "/" + numAddresses;
            document.getElementById("current").innerHTML = JSON.stringify(data[position-1]).replace(/"/g,"");
            updateMap(returnAddress(position));
        }

        function addressToCoordinates(location){
            try {
                const promise = axios.get('https://maps.googleapis.com/maps/api/geocode/json',{
                    params:{
                        address:location,
                        key:'AIzaSyCIF_zp9VV0GYMv-G83OVHa-NdVKsK5GJE'
                    }
                })
                 return promise;
            }
            catch (error) {
                console.log(error);
            }
        }
 
        function updateMap(location){
            addressToCoordinates(location).then((response)=>{
                let lat = response.data.results[0].geometry.location.lat;
                let long = response.data.results[0].geometry.location.lng;
                let placeID = response.data.results[0].place_id;
 
                var newSatellite = "https://www.google.com/maps/embed/v1/place?q=place_id:" + placeID + "&key=AIzaSyCIF_zp9VV0GYMv-G83OVHa-NdVKsK5GJE&zoom=21&maptype=satellite";
                document.getElementById("satellite").src = newSatellite;
                var newStreet = "https://www.google.com/maps/embed/v1/streetview?key=AIzaSyCIF_zp9VV0GYMv-G83OVHa-NdVKsK5GJE&location=" + lat + "%2C" + long;
                document.getElementById("street").src = newStreet;
            })
        }

        function returnAddress(position){
            currentAddress = data[position-1];
            document.getElementById("current").innerHTML = currentAddress;
            return currentAddress;
        }
    </script>

</body>
</html>
