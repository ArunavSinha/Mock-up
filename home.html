<!DOCTYPE html>
<html lang="en">

<head>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <title>User Interface Mock-Up</title>

    <style>
        * {
            box-sizing: border-box;
        }

        p {
            font-size: 20px; 
            line-height: 0;
            text-align: center;
        }

        h1 {
            margin-bottom: 25px;
        }

        .row{
            display: flex;
            width: 100%;
        }

        .row div {
            width: 50%;
        }

        .Margin {
            margin: 0px;
        }


        /* Satellite View */
        article1 { 
            float: left;
            width: 98%;
            height: 450px;
            border: solid 1px;
        }

        /* Additional Information */
        article2 {
            float: left;
            margin-top: 10px;
            width: 98%;
            height: 150px;
            border: solid 1px;
        }

        /* Street View */
        article3 {
            float: right;
            width: 98%;
            height: 295px;
            border: solid 1px;
        }

        /* Map View */
        article4 {
            float: left;
            margin-left: 2%;
            margin-top: -145px;
            width: 60%;
            height: 305px; 
            border: solid 1px;
        }

        /* Current Address and Buttons */
        article5 {
            margin-top: -305px; 
            float: right;
            width: 60%;
            height: 295px; 
        }

        input.ChooseSubmit {
            font-size: 16px; 
            cursor: pointer;
        }
        .myDiv {
            margin-left: 200px;
            text-align: center;
            overflow-wrap: break-word;
            font-size: 20px;
        }

        .inline {
            padding: 10px 20px;
            text-align: center;
            font-size: 16px;
            cursor: pointer;
            vertical-align: middle;
            display: inline-block;
            margin-right: 10px;
            margin-top: 10px;
        }

    </style>
</head>

<body>
    <h1 style="text-align: center;">User Interface Mock-Up</h1>
    <section>

        <div class="row 1"> 
            <div>
                <article1>
                    <p><strong>Satellite View</strong></p>
                    <iframe id="satellite" width="100%" height="91.1%" style="border:0" loading="lazy" allowfullscreen src="https://www.google.com/maps/embed/v1/place?q=place_id:ChIJq0KHTFYEzkwRvbPlVjh1VnI&key=AIzaSyCIF_zp9VV0GYMv-G83OVHa-NdVKsK5GJE&zoom=18&maptype=satellite"></iframe>
                </article1>
            </div>
            <div>
                <article3>
                    <p><strong>Street View</strong></p>
                    <iframe id="street" width="100%" height="253px" style="border:0" loading="lazy" allowfullscreen src="https://www.google.com/maps/embed/v1/streetview?key=AIzaSyCIF_zp9VV0GYMv-G83OVHa-NdVKsK5GJE&location=45.4220%2C-75.7055&heading=170&pitch=16"></iframe>
                </article3>
                
            </div>
        </div>

        <div class="row 2">
            <div>
                <article2>
                    <p><strong>Additional Information</strong></p>
                </article2>
            </div>
            <div>
                <article4>
                    <p><strong>Map View</strong></p>
                    <iframe id="map" width="99.9%" height="87%" style="border:0" loading="lazy" allowfullscreen src="https://www.google.com/maps/embed/v1/place?q=place_id:ChIJq0KHTFYEzkwRvbPlVjh1VnI&key=AIzaSyCIF_zp9VV0GYMv-G83OVHa-NdVKsK5GJE&zoom=18"></iframe>
                </article4>
                <article5>
                    <p style="margin-left: 170px"><strong>Current Address</strong></p>
                    <div id="current" class="myDiv">
                        301 Wellington St, Ottawa, ON K1A 0J1
                    </div>
                    <p id="position" style="line-height: 1.2; margin-left: 170px">1/1</p>
        
                    <form id="myForm">
                        <fieldset style="border: 0px; transform: translateX(8%);">
                            <input style="margin-left:170px; margin-top: 10px;" id="choose" type='file' id='csvFile' accept=".csv" class="ChooseSubmit">
                        </fieldset>
                    </form>
        
                    <button style="margin-left:225px" class="inline" id="previous" onclick="previous();">Previous</button>
                    <button class="inline" id="next" onclick="next();">Next</button>
                </article5>
            </div>
        </div>
    </section>

    <script>
        var numAddresses = 1;
        var position = 1;
        var counter = 1;
        var data, currentAddress, lat, long, placeID, formattedAddress;
        var csvFile = document.getElementsByTagName('input')[0];
        
        csvFile.onclick = function(){
            this.value = null;
        };
        csvFile.onchange = function(){
            loadFile();
        };

        function loadFile(){
            if (!csvFile.files[0]) {
                alert("Please select a file");
            }
            else if (csvFile.files[0].name.split(".").pop() !== "csv"){
                csvFile = null;
                alert("The file must be of type 'csv'");
            }  

            function csvToArray(allText) {
                var allTextLines = allText.split(/\r\n|\n/);
                var headers = allTextLines[0].split(',');
                var lines = [];
                for (var i=1; i<allTextLines.length; i++) {
                    var data = allTextLines[i].split(',');
                    if (data.length == headers.length) {
                        for (var j=0; j<headers.length; j++) {
                            lines.push(data[j]);
                        }
                    }
                }
                return lines.slice(0, -1);
            }
        
            var input = csvFile.files[0];
            var reader = new FileReader();
    
            reader.onload = function (e) {
                var text = e.target.result;
                data = csvToArray(text);
                numAddresses = data.length;
                document.getElementById("position").innerHTML = position + "/" + numAddresses;
                updateMap(returnAddress(position));
            };
            reader.readAsText(input);
        }

        function next(){
            if (!csvFile.files[0]) {
                alert("Please choose a file before clicking 'Next'");
            }
            if (position < numAddresses){
                position++;
                currentAddress = data[position-1];
            }
            document.getElementById("position").innerHTML = position + "/" + numAddresses;
            updateMap(returnAddress(position));
        }

        function previous(){
            if (!csvFile.files[0]) {
                alert("Please choose a file before clicking 'Previous'");
            }
            if (position > 1){
                position--;
                currentAddress = data[position-1];
            }
            document.getElementById("position").innerHTML = position + "/" + numAddresses;
            updateMap(returnAddress(position));
        }

        function addressToCoordinates(location){
            try {
                const promise = axios.get('https://maps.googleapis.com/maps/api/geocode/json',{
                    params:{
                        address:location,
                        key:'AIzaSyCIF_zp9VV0GYMv-G83OVHa-NdVKsK5GJE'
                    }
                })
                 return promise;
            }
            catch (error) {
                console.log(error);
            }
        }
 
        function updateMap(location){
            addressToCoordinates(location).then((response)=>{
                let lat = response.data.results[0].geometry.location.lat;
                let long = response.data.results[0].geometry.location.lng;
                let placeID = response.data.results[0].place_id;
                let formattedAddress = response.data.results[0].formatted_address;
                document.getElementById("current").innerHTML = formattedAddress;
 
                var newSatellite = "https://www.google.com/maps/embed/v1/place?q=place_id:" + placeID + "&key=AIzaSyCIF_zp9VV0GYMv-G83OVHa-NdVKsK5GJE&zoom=21&maptype=satellite";
                document.getElementById("satellite").src = newSatellite;
                var newStreet = "https://www.google.com/maps/embed/v1/streetview?key=AIzaSyCIF_zp9VV0GYMv-G83OVHa-NdVKsK5GJE&location=" + lat + "%2C" + long;
                document.getElementById("street").src = newStreet;
                var newMap = "https://www.google.com/maps/embed/v1/place?q=place_id:" + placeID + "&key=AIzaSyCIF_zp9VV0GYMv-G83OVHa-NdVKsK5GJE&zoom=19";
                document.getElementById("map").src = newMap; 
            })
        }

        function returnAddress(position){
            currentAddress = data[position-1];
            return currentAddress;
        }
    </script>

</body>
</html>
